#!/usr/bin/ruby

### Globals FTW
@host = "nic-hadoop-smmc07"
@db = 'person'
@tables = ['inno_05', 'hc_05']

### QUERIES

countQuery = lambda{|table| "SELECT COUNT(*) FROM #{table};"}
addressQuery = lambda{|table| "SELECT * FROM #{table} WHERE address < '500' AND zip > '3000' AND state='VT' AND country='Mexico';"}
firstNameQuery = lambda{|table| "SELECT * FROM #{table} WHERE first_name = 'Robert';"}

@queries = [countQuery,addressQuery,firstNameQuery]

### RUN
def analyzeBench(query, concurrency, iterations)
  `./mysqlslap --delimiter=";" --create="" --query="#{query}" --concurrency=#{concurrency} --iterations=#{iterations} --no-create --no-drop --create-schema=#{@db} --host=#{@host} --user="root"`
end

def runBenchmarks
  @queries.each do |query|
    @tables.each do |table|
      table_query = query.call(table)
      printf("Query,%s,", table_query)
      puts analyzeBench(table_query, 10, 5)
    end
  end
end

runBenchmarks
