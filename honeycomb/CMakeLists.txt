if (DEFINED ENV{JAVA_HOME})
  MESSAGE( "JAVA HOME: $ENV{JAVA_HOME}" )
else()
  MESSAGE( "******** ERROR: JAVA_HOME not defined.  If running cmake with sudo consider using the -E flag" )
endif()

INCLUDE_DIRECTORIES("$ENV{JAVA_HOME}/include")
EXEC_PROGRAM(xml2-config ARGS --cflags OUTPUT_VARIABLE LIBXML2_INCLUDE)
STRING(REPLACE -I "" LIBXML2_INCLUDE ${LIBXML2_INCLUDE})
INCLUDE_DIRECTORIES(${LIBXML2_INCLUDE})

if (APPLE)
  MESSAGE( "Compiling on Apple System" )
  SET(LIBS "-lxml2 -framework JavaVM")
else()
  MESSAGE( "Compiling on Linux System" )
  INCLUDE_DIRECTORIES("$ENV{JAVA_HOME}/include/linux")
  LINK_DIRECTORIES("$ENV{JAVA_HOME}/jre/lib/amd64")
  LINK_DIRECTORIES("$ENV{JAVA_HOME}/jre/lib/amd64/server")
  LINK_DIRECTORIES("$ENV{JAVA_HOME}/jre/lib/amd64/xawt")
  SET(LIBS jawt jvm jsig xml2)
endif()

SET(HONEYCOMB_PLUGIN_DYNAMIC "ha_honeycomb")
SET(HONEYCOMB_SOURCES HoneycombHandler.cc Search.cc Crud.cc ha_honeycomb.cc Util.cc JNISetup.cc Logging.cc Java.cc)
SET(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -Wall -Wno-error -g")
SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Wall -Wno-error -g")
MYSQL_ADD_PLUGIN(honeycomb ${HONEYCOMB_SOURCES} STORAGE_ENGINE MODULE_ONLY
  LINK_LIBRARIES  ${LIBS})
